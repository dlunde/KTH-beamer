\mode<presentation>

% OPTIONS

% "footerstyle": The footer style to use for the outer theme. Available styles:
%  - lr: Left and right footer contents
%  - lcr: Left, center, and right footer contents
\newcommand\beamer@KTH@footerstyle{lr}
\newcommand\kthfooterstyle[1]{\renewcommand\beamer@KTH@footerstyle{#1}}
\DeclareOptionBeamer{footerstyle}{\kthfooterstyle{#1}}

% "lfoot": Contents of the left footer
\newcommand\beamer@KTH@lfoot{\insertdate}
\newcommand\kthlfoot[1]{\renewcommand\beamer@KTH@lfoot{#1}}
\DeclareOptionBeamer{lfoot}{\kthlfoot{#1}}

% "cfoot": Contents of the center footer
\newcommand\beamer@KTH@cfoot{\inserttitle}
\newcommand\kthcfoot[1]{\renewcommand\beamer@KTH@cfoot{#1}}
\DeclareOptionBeamer{cfoot}{\kthcfoot{#1}}

% "rfoot": Contents of the right footer
\newcommand\beamer@KTH@rfoot{\insertframenumber\,/\,\inserttotalframenumber}
\newcommand\kthrfoot[1]{\renewcommand\beamer@KTH@rfoot{#1}}
\DeclareOptionBeamer{rfoot}{\kthrfoot{#1}}

\ProcessOptionsBeamer

% REQUIRED PACKAGES
\RequirePackage{graphicx}
\RequirePackage{tikz}
\RequirePackage{pdftexcmds}

% COMMANDS
\newcommand\extra[1]{\renewcommand\@extra{#1}}
\newcommand\@extra{}

\newcommand\footline[1]{\renewcommand\@footline{#1}}
\newcommand\@footline{}

% COLOR
\definecolor{kthblue}{RGB}{25,84,166} % use structure theme to change

\setbeamercolor{frametitle}{fg=kthblue}
\setbeamercolor{framesubtitle}{fg=kthblue}
\setbeamercolor{structure}{fg=kthblue}

\setbeamercolor{page number in head/foot}{fg=gray}


% INNER THEME
\defbeamertemplate*{title page}{kth}[1][]
{
  \tikz[remember picture,overlay]%
  \node[inner sep=0cm, xshift=3.75mm, yshift=-3.75mm, anchor=north west]%
  at (current page.north west)%
  {\includegraphics[width=15mm, height=15mm, keepaspectratio]{img/logo.pdf}};
  \tikz[remember picture,overlay]%
  \node[inner sep=0cm, xshift=3.75mm, yshift=-22.5mm, anchor=north west]%
  at (current page.north west)%
  {\@extra};
  \tikz[remember picture,overlay]%
  \node[yshift=1mm, inner sep=2.5mm, anchor=south]%
  at (current page.south)%
  {\includegraphics[width=0.94\paperwidth,trim=25cm 0 20cm 0,clip]{img/lines.pdf}};
  \vskip 2mm
  \begin{beamercolorbox}[leftskip=13mm, #1]{title}
    \usebeamerfont{title}\inserttitle\par%
    \ifx\insertsubtitle\@empty%
    \else%
    \vspace{2mm}
    {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
    \fi%
  \end{beamercolorbox}\vspace{4mm}
  \begin{beamercolorbox}[leftskip=13mm,#1]{author}
    \usebeamerfont{author}\insertauthor
  \end{beamercolorbox}\vspace{2mm}
  \begin{beamercolorbox}[leftskip=13mm,#1]{institute}
    \usebeamerfont{institute}\insertinstitute
  \end{beamercolorbox}\vspace{2mm}
  \begin{beamercolorbox}[leftskip=13mm,#1]{date}
    \usebeamerfont{date}\insertdate
  \end{beamercolorbox}
}

% OUTER THEME
\defbeamertemplate*{navigation symbols}{kth}{}

\defbeamertemplate*{footline}{kth}
{
  \tikz[remember picture,overlay]%
  \draw[color=kthblue,yshift=8pt] (0.03\paperwidth,0) -- (0.97\paperwidth,0);%
  \usebeamercolor[fg]{page number in head/foot}%
  \usebeamerfont{page number in head/foot}%
  \hspace*{0.03\paperwidth}%
  % Select footer style (The @{} in tabular removes any padding between cells.)
  \ifnum\pdf@strcmp{\beamer@KTH@footerstyle}{lr}=0%
    \parbox[c][8mm][c]{0.70\paperwidth}{%
      \begin{tabular}{@{}p{0.47\paperwidth}@{}p{0.47\paperwidth}@{}}%
      \raggedright\beamer@KTH@lfoot & %
      \raggedleft\beamer@KTH@rfoot%
      \end{tabular}%
    }%
  \else\ifnum\pdf@strcmp{\beamer@KTH@footerstyle}{lcr}=0%
    \parbox[c][8mm][c]{0.70\paperwidth}{%
      \begin{tabular}{@{}p{0.15\paperwidth}@{}p{0.64\paperwidth}@{}p{0.15\paperwidth}@{}}%
      \raggedright\beamer@KTH@lfoot & %
      \centering\beamer@KTH@cfoot & %
      \raggedleft\beamer@KTH@rfoot%
      \end{tabular}%
    }%
  \else%
    \PackageError{beamerthemekth}{Invalid footer style \beamer@KTH@footerstyle}{extra help}
  \fi\fi%
  \hspace*{0.03\paperwidth}%
  \vspace{-1.1mm}
}

\defbeamertemplate*{frametitle}{kth}[1][left]
{
  \ifbeamercolorempty[bg]{frametitle}{}{\nointerlineskip}%
  \@tempdima=\textwidth%
  \advance\@tempdima by\beamer@leftmargin%
  \advance\@tempdima by\beamer@rightmargin%
  \begin{beamercolorbox}[#1,wd=\the\@tempdima]{frametitle}
    \usebeamerfont{frametitle}%
    \vspace{0cm}% This aligns the colorbox at the top for some reason
    \begin{minipage}[t][][c]{15mm}
      \tikz \node[inner sep=2.5mm] {\includegraphics[height=10mm]{img/logo.pdf}};
    \end{minipage}%
    \begin{minipage}[t][][c]{0.8\paperwidth}
      \vspace{8pt}
      % If no subtitle, center title with logo
      \ifx\insertframesubtitle\@empty%
        \vspace{6pt}%
      \fi%
      \usebeamerfont{frametitle}%
      \vbox{}\vskip-1ex%
    \if@tempswa\else\csname beamer@fte#1\endcsname\fi%
      \strut\insertframetitle\strut\par%
      {%
        \ifx\insertframesubtitle\@empty%
      \else%
        {\usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}%
        \insertframesubtitle\strut\par}%
      \fi
    }%
    \vskip-1ex%
  \if@tempswa\else\vskip-.3cm\fi% set inside beamercolorbox... evil here...
  \end{minipage}%
  \end{beamercolorbox}%
}

\mode
<all>
